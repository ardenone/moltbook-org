---
# GHCR Credentials Secret Template
#
# This template creates a Kubernetes secret for authenticating to GitHub Container Registry (GHCR).
# Kaniko uses this secret to push built images to ghcr.io/ardenone/*.
#
# IMPORTANT: This is a TEMPLATE file. Do NOT commit the generated secret to Git.
# Create the actual secret using the command below, or use SealedSecret for GitOps.
#
# TO CREATE THE SECRET:
# ====================
#
# Option 1: Using kubectl (recommended for testing)
# -------------------------------------------------
# kubectl create secret docker-registry ghcr-credentials \
#   --docker-server=ghcr.io \
#   --docker-username=ardenone \
#   --docker-password=<YOUR_GITHUB_TOKEN> \
#   -n moltbook
#
# Option 2: Using this template file
# ---------------------------------
# 1. Copy this file to ghcr-credentials.yml
# 2. Replace <BASE64_ENCODED_DOCKER_CONFIG_JSON> with base64-encoded .dockerconfigjson
# 3. kubectl apply -f ghcr-credentials.yml
#
# To generate the base64-encoded .dockerconfigjson:
# ------------------------------------------------
# echo '{"auths":{"ghcr.io":{"username":"ardenone","password":"<GITHUB_TOKEN>","auth":"<BASE64_AUTH>"}}}' | base64 -w 0
#
# Where <BASE64_AUTH> is: echo -n "ardenone:<GITHUB_TOKEN>" | base64
#
# GITOPS APPROACH (SealedSecret):
# ===============================
# For production GitOps, use SealedSecret instead:
#
# 1. Install kubeseal: https://github.com/bitnami-labs/sealed-secrets
# 2. Create the secret temporarily:
#    kubectl create secret docker-registry ghcr-credentials \
#      --docker-server=ghcr.io \
#      --docker-username=ardenone \
#      --docker-password=<YOUR_GITHUB_TOKEN> \
#      -n moltbook \
#      --dry-run=client -o yaml > ghcr-credentials-temp.yml
# 3. Seal the secret:
#    kubeseal --format yaml < ghcr-credentials-temp.yml > ghcr-credentials-sealedsecret.yml
# 4. Commit the SealedSecret to Git
# 5. Delete the temporary file:
#    rm ghcr-credentials-temp.yml
#
# REQUIRED SCOPES FOR GITHUB_TOKEN:
# =================================
# - write:packages - Required for pushing images
# - read:packages - Required for pulling images
#
# Create a Personal Access Token at: https://github.com/settings/tokens
#
apiVersion: v1
kind: Secret
metadata:
  name: ghcr-credentials
  namespace: moltbook
  labels:
    app: kaniko-build-runner
type: kubernetes.io/dockerconfigjson
data:
  # DO NOT COMMIT THIS FILE
  # Replace <BASE64_ENCODED_DOCKER_CONFIG_JSON> with actual value
  .dockerconfigjson: <BASE64_ENCODED_DOCKER_CONFIG_JSON>
