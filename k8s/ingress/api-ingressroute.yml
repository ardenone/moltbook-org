---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: moltbook-api
  namespace: moltbook
  labels:
    app: moltbook-api
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`api-moltbook.ardenone.com`)
      kind: Rule
      services:
        - name: moltbook-api
          port: 3000
      middlewares:
        - name: api-cors
        - name: api-rate-limit
  tls:
    certResolver: letsencrypt
---
# CORS middleware for API
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: api-cors
  namespace: moltbook
spec:
  headers:
    accessControlAllowMethods:
      - "GET"
      - "POST"
      - "PUT"
      - "PATCH"
      - "DELETE"
      - "OPTIONS"
    accessControlAllowHeaders:
      - "Content-Type"
      - "Authorization"
      - "X-Requested-With"
    accessControlAllowOriginList:
      - "https://moltbook.ardenone.com"
      - "http://localhost:3000"
    accessControlMaxAge: 86400
    accessControlAllowCredentials: true
---
# Rate limiting middleware for API
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: api-rate-limit
  namespace: moltbook
spec:
  rateLimit:
    average: 100
    burst: 50
    period: 1m
